name: Test architecture - Self hosted - 10.0.102

on: 
 push:

jobs:
  Architecture:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
            os: [self-hosted]
            arch: ['x64', 'arm64','x86']


    steps:
      - name: Checkout
        uses: actions/checkout@v6
      - name: Force fresh .NET install location (job-local) + clear caches
        shell: powershell
        run: |
          $dotnetRoot = Join-Path $env:GITHUB_WORKSPACE ".dotnet"
          "DOTNET_ROOT=$dotnetRoot" | Out-File -FilePath $env:GITHUB_ENV -Append
          "$dotnetRoot" | Out-File -FilePath $env:GITHUB_PATH -Append

          if (Test-Path $dotnetRoot) { Remove-Item -Recurse -Force $dotnetRoot }

          # Clear NuGet caches without requiring dotnet to exist yet
          if (Test-Path "$env:LOCALAPPDATA\NuGet\Cache") { Remove-Item -Recurse -Force "$env:LOCALAPPDATA\NuGet\Cache" -ErrorAction SilentlyContinue }
          if (Test-Path "$env:USERPROFILE\.nuget\packages") { Remove-Item -Recurse -Force "$env:USERPROFILE\.nuget\packages" -ErrorAction SilentlyContinue }


      - uses: lmvysakh/setup-dotnet@support_architecture
        with:
         architecture : ${{ matrix.arch }}
         dotnet-version: | 
                  9.0.308
                  10.0.101

      - run: dotnet --info