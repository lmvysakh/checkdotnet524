name: Dummy

on:
  workflow_dispatch:


jobs:
  multi_arch_dotnet:
    runs-on: macos-14 # Or 'macos-latest'; ensure Apple Silicon runner.
    steps:
      - uses: actions/checkout@v4

      # Use the setup-dotnet action from the PR branch (implementing arch selection)
      - name: Setup .NET SDKs (arm64 and x64)
        uses: DataDog/setup-dotnet@architecture2
        with:
          dotnet: |
            - version: '8.0.x'
              arch: 'arm64'
            - version: '8.0.x'
              arch: 'x64'

      # Try both SDKs sequentially
      - name: Show installed dotnet SDKs (default arch = arm64)
        run: |
          dotnet --list-sdks
          dotnet --info

      # - name: Use x64 .NET SDK explicitly via path
      #   run: |
      #     echo "x64 SDK location:"
      #     DOTNET_ROOT_X64=$(find $RUNNER_TOOL_CACHE/dotnet -type d -name 'x64' | head -n1)
      #     # Use .NET x64
      #     if [ -d "$DOTNET_ROOT_X64" ]; then
      #       "$DOTNET_ROOT_X64/dotnet" --version
      #       "$DOTNET_ROOT_X64/dotnet" --info
      #     else
      #       echo "x64 SDK not found!"
      #       exit 1
      #     fi

      - name: Use arm64 .NET SDK explicitly via path
        run: |
          echo "arm64 SDK location:"
          DOTNET_ROOT_ARM64=$(find $RUNNER_TOOL_CACHE/dotnet $HOME/.dotnet /usr/local/share/dotnet -type d -name 'arm64' 2>/dev/null | head -n1)
          if [ -d "$DOTNET_ROOT_ARM64" ]; then
            "$DOTNET_ROOT_ARM64/dotnet" --version
            "$DOTNET_ROOT_ARM64/dotnet" --info
          else
            echo "arm64 SDK not found!"
            exit 1
          fi

      - name: Verify arm64 .NET SDK installation
        run: |
          echo "Installed SDKs:"
          dotnet --list-sdks
          if dotnet --list-sdks | grep -q "8.0"; then
            dotnet --info
          else
            echo "arm64 SDK not found!"
            exit 1
          fi


      - name: Verify x64 .NET SDK installation
        env:
          DOTNET_ROOT: $RUNNER_TOOL_CACHE/dotnet/x64
        run: |
          echo "Verifying x64 .NET SDK installation..."
          if find $RUNNER_TOOL_CACHE/dotnet -type d -name 'x64' 2>/dev/null | grep .; then
            DOTNET_X64_PATH=$(find $RUNNER_TOOL_CACHE/dotnet -type d -name 'x64' | head -n1)
            if [ -x "$DOTNET_X64_PATH/dotnet" ]; then
              "$DOTNET_X64_PATH/dotnet" --list-sdks
              "$DOTNET_X64_PATH/dotnet" --info
            else
              echo "x64 dotnet binary not found!"
              exit 1
            fi
          else
            echo "x64 SDK directory not found!"
            exit 1
          fi